name: Quote of the Day

on:
  schedule:
    - cron: "0 6 * * *" # every day at 06:00 UTC
  workflow_dispatch: {} # Allows manual triggering

permissions:
  contents: write

jobs:
  fetch-quote:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Pick random quote
        run: |
          node -e '
            const fs = require("fs");
            const data = JSON.parse(fs.readFileSync("quotes/all.json", "utf8"));
            const authors = Object.keys(data);
            const author = authors[Math.floor(Math.random() * authors.length)];
            const quote = data[author][Math.floor(Math.random() * data[author].length)];
            if(quote.length){
              const output = `export const quoteOfTheDay = {\n  author: ${JSON.stringify(author)},\n  quote: ${JSON.stringify(quote)}\n};\n`;
              fs.writeFileSync("quotes/daily.js", output);
            }
          '

      - name: Commit and push if changed
        run: |
          if git diff --quiet quotes/daily.js; then
            echo "No changes to commit."
          else
            git config --global user.name "github-actions[bot]"
            git config --global user.email "github-actions[bot]@users.noreply.github.com"
            git add quotes/daily.js
            git commit -m "Update quote of the day"
            git push
          fi
